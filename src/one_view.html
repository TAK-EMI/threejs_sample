<!DOCTYPE html>
<html lang="ja">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>一面図</title>
	<script src="../lib/three.min.js"></script>
	<script src="../lib/js/loaders/OBJLoader.js"></script>
</head>
<body>
	<a href="https://tak-emi.github.io/threejs_sample/">戻る</a><br>
	<canvas id="canvas"></canvas>
	<script>
		var scene = new THREE.Scene();
	</script>
	<script>
		var camera;
		var elCanvas = document.querySelector("#canvas");
	</script>
	<script>
		var mousePos = new THREE.Vector3();
		var mouseDown = false;
		elCanvas.addEventListener('mousedown', (event) => {
			mouseDown = true;

			var rect = elCanvas.getBoundingClientRect();

			mousePos.x = ((event.clientX - rect.left) / rect.width) * 2 - 1;
			mousePos.y = - ((event.clientY - rect.top) / rect.height) * 2 + 1;
		}, false);
		elCanvas.addEventListener('mousemove', (event) => {
			if(mouseDown) {
				var rect = elCanvas.getBoundingClientRect();

				var pos = new THREE.Vector3();
				pos.x = ((event.clientX - rect.left) / rect.width) * 2 - 1;
				pos.y = - ((event.clientY - rect.top) / rect.height) * 2 + 1;

				var vec = pos.sub(mousePos);
				camera.translateOnAxis(vec, 1);
				mousePos = pos;
			}
		}, false);
		elCanvas.addEventListener('mouseup', (event) => {
			mouseDown = false;
		}, false);
	</script>
	<script>
		const group = new THREE.Group();

		function initModel()
		{
			var manager = new THREE.LoadingManager();

			var onProgress = (xhr) => {
				if(xhr.lengthComputable) {
					var percentComplete = xhr.loaded / xhr.total * 100;
					console.log(Math.round(percentComplete, 2) + '% downloaded');
				}
			};

			var onError = (err) => {
				console.log(`Error: ${err}`);
				
			};

			new THREE.OBJLoader(manager)
				.setPath('https://tak-emi.github.io/threejs_sample/obj/teapot/')
				.load('teapot.obj', object => {

					var wire = new THREE.LineSegments(
						new THREE.WireframeGeometry(object.children[0].geometry),
						new THREE.LineBasicMaterial({
							color: 0x000000,
							linewidth: 2
						})
					);
					scene.add(wire);

				}, onProgress, onError);
			
			return;
		}
	</script>
	<script>
		const width = 500;
		const height = 300;

		camera = new THREE.OrthographicCamera(width / -2, width / 2, height / 2, height / -2, -100, 1000);
		camera.position.set(10, 10, 10);

		var gridHelper = new THREE.GridHelper( width * 100, 1000 );
		gridHelper.rotateX(Math.PI / 2);
		scene.add( gridHelper );

		var axesHelper = new THREE.AxesHelper( 1000 );
		scene.add( axesHelper );

		const light = new THREE.DirectionalLight(0xffffff);
		light.intensity = 2;
		light.position.set(2, 2, 1);
		scene.add(light);

		var renderer = new THREE.WebGLRenderer({
				canvas: elCanvas
			});
		renderer.setSize( width, height );
		renderer.setClearColor(0xaaaaaa);

		initModel();

		function animate() {
			requestAnimationFrame( animate );

			renderer.render( scene, camera );
		}

		animate();
	</script>
</body>
</html>
