<!DOCTYPE html>
<html lang="ja">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>テンプレート</title>
	<script src="../lib/three.min.js"></script>
	<script src="../lib/js/controls/OrbitControls.js"></script>
	<script src="../lib/js/controls/TransformControls.js"></script>
</head>

<body>
	<a href="https://tak-emi.github.io/threejs_sample/">戻る</a><br>
	<form action="" id="form">
		<input type="radio" id="translate" name="transform" checked onclick="update()">移動
		<input type="radio" id="rotate" name="transform" onclick="update()">回転
		<input type="radio" id="scale" name="transform" onclick="update()">拡縮
	</form>
	<canvas id="canvas"></canvas>
	<script>
		var scene = new THREE.Scene();
		var control;
	</script>
	<script>
		function update() {
			const elTranslate = document.querySelector('#translate');
			const elRotate = document.querySelector('#rotate');
			const elScale = document.querySelector('#scale');

			if (elTranslate.checked === true) {
				control.setMode("translate");
			} else if (elRotate.checked === true) {
				control.setMode("rotate");
			} else if (elScale.checked === true) {
				control.setMode("scale");
			}
		}
		function initBox() {
			const box = new THREE.Mesh(
				new THREE.BoxGeometry(5, 5, 5),
				new THREE.MeshLambertMaterial({ color: 0x800080 })
			);

			scene.add(box);

			control.attach(box);
			scene.add(control);

			update();

			return;
		}
	</script>
	<script>
		const width = 500;
		const height = 300;

		var camera = new THREE.PerspectiveCamera(75, width / height, 0.1, 10000);

		camera.position.set(10, 10, 10);

		var gridHelper = new THREE.GridHelper(100, 100);
		scene.add(gridHelper);

		var axesHelper = new THREE.AxesHelper(1000);
		scene.add(axesHelper);

		const light = new THREE.DirectionalLight(0xffffff);
		light.intensity = 2;
		light.position.set(2, 2, 1);
		scene.add(light);

		var renderer = new THREE.WebGLRenderer({
			canvas: document.querySelector("#canvas")
		});
		renderer.setSize(width, height);
		renderer.setClearColor(0xaaaaaa);

		const orbit = new THREE.OrbitControls(camera, renderer.domElement);
		orbit.update();

		control = new THREE.TransformControls(camera, renderer.domElement);
		control.addEventListener('change', animate);
		control.addEventListener('dragging-changed', function (event) {
			orbit.enabled = !event.value;
		});

		initBox();

		function animate() {
			requestAnimationFrame(animate);

			orbit.update();

			renderer.render(scene, camera);
		}

		animate();
	</script>
</body>

</html>
